(this["webpackJsonpreact-express-starter"]=this["webpackJsonpreact-express-starter"]||[]).push([[0],{201:function(e,a,t){"use strict";t.r(a);var n=t(0),c=t.n(n),r=t(71),o=t.n(r),l=(t(92),t(93),t(26)),i=t.n(l),s=t(72),d=t(5),m=t(73),u=t.n(m),p=t(74),b=t.n(p);var g=({username:e,handleUsernameChange:a,roomName:t,handleRoomNameChange:n,handleSubmit:r})=>c.a.createElement("div",null,c.a.createElement("div",{className:"home-nav-bar"},c.a.createElement("div",{className:"margin-top-8"},c.a.createElement("div",{className:"center"},c.a.createElement("img",{src:u.a,width:"96px"})))),c.a.createElement("form",{onSubmit:r},c.a.createElement("div",{className:"margin-top-64 futura-20-900 center"},"Virtual Rehab 1-on-1"),c.a.createElement("div",{className:"margin-top-16"},c.a.createElement("input",{type:"text",id:"field",placeholder:"Your Display Name",value:e,onChange:a,required:!0})),c.a.createElement("div",null,c.a.createElement("input",{type:"text",id:"room",placeholder:"Room Name",value:t,onChange:n,required:!0})),c.a.createElement("div",{className:"margin-top-8 futura-14-300"},"* Enter the room name you were given from your confirmation email."),c.a.createElement("center",null,c.a.createElement("img",{src:b.a,style:{height:"25vh"}})),c.a.createElement("div",{className:"onboarding-bottom-nav-bar"},c.a.createElement("button",{style:""===e||""===t?{background:"#E1E2E3"}:null,className:"green-button",type:"submit"},"JOIN VIDEO CALL")))),h=t(75),E=t.n(h);var f=({participant:e,handleCallDisconnect:a,handleAudioToggle:t,handleVideoToggle:r,toggleAudio:o,toggleVideo:l,isLocal:i,isSharingScreen:s})=>{console.log("refresh ?????");const m=Object(n.useState)([]),u=Object(d.a)(m,2),p=u[0],b=u[1],g=Object(n.useState)([]),h=Object(d.a)(g,2),E=h[0],f=h[1],v=Object(n.useRef)(),k=Object(n.useRef)(),O=Object(n.useRef)(),j=e=>Array.from(e).map(e=>e.track).filter(e=>null!==e);return Object(n.useEffect)(()=>{b(j(e.videoTracks.values())),f(j(e.audioTracks.values())),console.log(e);const a=e=>{const a=e.track?e.track:e;"video"===a.kind?b(e=>[...e,a]):f(e=>[...e,a])},t=e=>{const a=e.track?e.track:e;"video"===a.kind?b(e=>e.filter(e=>e!==a)):f(e=>e.filter(e=>e!==a))};return i&&e.on("trackPublished",a),i&&e.on("trackUnpublished",t),!i&&e.on("trackSubscribed",a),!i&&e.on("trackUnsubscribed",t),()=>{b([]),f([]),e.removeAllListeners()}},[e]),Object(n.useEffect)(()=>{console.log("attaching video track",p);let e=[];const a=e=>p.reduce((a,t)=>a||(t.name===e?t:a),null),t=()=>{const e=a("screen");return e&&e.isEnabled?e:a("webcam")};console.log(s,i);const n=i?a("webcam"):t(),c=t();return!i&&c&&c.on("disabled",e=>{console.log("remote screenTrack was disabled");const t=a("webcam");t&&t.attach(v.current)}),!i&&c&&c.on("enabled",e=>{console.log("remote screenTrack was enabled"),c.attach(v.current)}),console.log(p,n,c),n&&(n.attach(v.current),e.push(n)),c&&(console.log("screnRef",k,k.current),e.push(c),c.attach(k.current)),()=>{e.forEach(e=>e&&e.detach())}},[p]),Object(n.useEffect)(()=>{const e=E[0];if(e)return e.attach(O.current),()=>{e.detach()}},[E]),c.a.createElement("div",null,c.a.createElement("div",{className:"futura-20-900 margin-top-8 margin-left-8",style:{color:"white"}},e.identity),c.a.createElement("video",{ref:k,autoPlay:!0,style:{display:"".concat(s?"block":"none")}}),c.a.createElement("video",{ref:v,autoPlay:!0}),c.a.createElement("audio",{ref:O,autoPlay:!0}))},v=t(27),k=t(28),O=t(76),j=t.n(O),N=t(77),w=t.n(N),y=t(78),S=t.n(y),C=t(79),x=t.n(C),T=t(80),P=t.n(T),A=t(81),D=t.n(A),R=t(82),V=t.n(R);function L(){const e=Object(v.a)(["\n    max-width: 100%;\n    width: 45px;\n    margin: 0 auto;\n  "]);return L=function(){return e},e}function _(){const e=Object(v.a)(["\n    width: 45px;\n    height: 45px;\n    border-radius: 50%;\n    display: flex;\n    cursor: pointer;\n    :not(:first-child) {\n      margin-left: 20px;\n    }\n  "]);return _=function(){return e},e}var F=({handleCallDisconnect:e,handleAudioToggle:a,handleVideoToggle:t,audio:n,video:r,screen:o,handleScreenToggle:l})=>c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"control"},c.a.createElement(I,{className:"column",onClick:t},c.a.createElement(J,{src:r?S.a:x.a})),c.a.createElement(I,{className:"column",onClick:a},c.a.createElement(J,{src:n?j.a:w.a})),c.a.createElement(I,{className:"column",onClick:l},c.a.createElement(J,{src:o?D.a:P.a})),c.a.createElement(I,{className:"column",onClick:e},c.a.createElement(J,{src:V.a}))));const I=k.a.div(_()),J=k.a.img(L());var U=({roomName:e,token:a,handleLogout:t})=>{const r=Object(n.useState)(null),o=Object(d.a)(r,2),l=o[0],i=o[1],s=Object(n.useState)([]),m=Object(d.a)(s,2),u=m[0],p=m[1],b=Object(n.useState)(!0),g=Object(d.a)(b,2),h=g[0],v=g[1],k=Object(n.useState)(!0),O=Object(d.a)(k,2),j=O[0],N=O[1],w=Object(n.useState)(!1),y=Object(d.a)(w,2),S=y[0],C=y[1],x=Object(n.useState)(null),T=Object(d.a)(x,2),P=T[0],A=T[1];Object(n.useEffect)(()=>{const t=e=>{p(a=>[...a,e])},n=e=>{p(a=>a.filter(a=>a!==e))};return E.a.connect(a,{name:e,audio:!0,video:{name:"webcam"}}).then(e=>{i(e),e.on("participantConnected",t),e.on("participantDisconnected",n),e.participants.forEach(t)}),()=>{i(e=>e&&"connected"===e.localParticipant.state?(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),e.disconnect(),null):e)}},[e,a]);const D=()=>{t(),l.disconnect(),window.close()},R=()=>{l.localParticipant.audioTracks.forEach(e=>{e.track.isEnabled?e.track.disable():e.track.enable(),v(e.track.isEnabled)})},V=()=>{l.localParticipant.videoTracks.forEach(e=>{console.log(e),e.track.isEnabled&&"screen"!==e.trackName?e.track.disable():e.track.enable(),N(e.track.isEnabled)})},L=u.map(e=>c.a.createElement(f,{key:e.sid,participant:e,isLocal:!1}));return c.a.createElement("div",{className:"room"},c.a.createElement("div",{className:"local-participant"},l?c.a.createElement(f,{key:l.localParticipant.sid,participant:l.localParticipant,handleAudioToggle:R,handleVideoToggle:V,handleCallDisconnect:D,toggleAudio:h,toggleVideo:j,isLocal:!0,isSharingScreen:S}):""),c.a.createElement("div",{className:"remote-participants"},L),c.a.createElement(F,{handleCallDisconnect:D,handleAudioToggle:R,handleVideoToggle:V,handleScreenToggle:()=>{P?l.localParticipant.videoTracks.forEach(e=>{console.log(e),e.track.isEnabled&&"screen"===e.trackName?e.track.disable():e.track.enable(),C(e.track.isEnabled)}):navigator.mediaDevices.getDisplayMedia().then(e=>{if(console.log(e),e){const a=e.getVideoTracks()[0],t=Array.from(l.localParticipant.videoTracks.values());console.log("Screen track",a),window.room=l,t.length,l.localParticipant.publishTrack(a,{name:"screen"}),C(!0),console.log(window.room,l,"published track",a),A(e)}})},audio:h,video:j,screen:S}))};var M=()=>{const e=Object(n.useState)(""),a=Object(d.a)(e,2),t=a[0],r=a[1],o=Object(n.useState)(""),l=Object(d.a)(o,2),m=l[0],u=l[1],p=Object(n.useState)(null),b=Object(d.a)(p,2),h=b[0],E=b[1],f=Object(n.useCallback)(e=>{r(e.target.value)},[]),v=Object(n.useCallback)(e=>{u(e.target.value)},[]),k=Object(n.useCallback)(function(){var e=Object(s.a)(i.a.mark((function e(a){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,fetch("/video/token",{method:"POST",body:JSON.stringify({identity:t,room:m}),headers:{"Content-Type":"application/json"}}).then(e=>e.json());case 3:n=e.sent,E(n.token);case 5:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),[m,t]),O=Object(n.useCallback)(e=>{E(null)},[]);let j;return j=h?c.a.createElement(U,{roomName:m,token:h,handleLogout:O}):c.a.createElement(g,{username:t,roomName:m,handleUsernameChange:f,handleRoomNameChange:v,handleSubmit:k}),j};var q=()=>c.a.createElement("div",{className:"app"},c.a.createElement("main",null,c.a.createElement(M,null)));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})},73:function(e,a,t){e.exports=t.p+"static/media/logo_webbanner.1f2ecda3.png"},74:function(e,a,t){e.exports=t.p+"static/media/1on1_asset.81cf532f.svg"},76:function(e,a,t){e.exports=t.p+"static/media/MIC_ON.31971651.svg"},77:function(e,a,t){e.exports=t.p+"static/media/MIC_OFF.a7b26dd1.svg"},78:function(e,a,t){e.exports=t.p+"static/media/VIDEO_ON.b7de8bfe.svg"},79:function(e,a,t){e.exports=t.p+"static/media/VIDEO_OFF.10e9454f.svg"},80:function(e,a,t){e.exports=t.p+"static/media/SCREENSHARE_ON.da09c0d4.svg"},81:function(e,a,t){e.exports=t.p+"static/media/SCREENSHARE_OFF.16ace628.svg"},82:function(e,a,t){e.exports=t.p+"static/media/ENDCALL.f27dcf5d.svg"},87:function(e,a,t){e.exports=t(201)},92:function(e,a,t){},93:function(e,a,t){}},[[87,1,2]]]);
//# sourceMappingURL=main.32ee26ef.chunk.js.map